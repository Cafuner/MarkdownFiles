# 9.Java平台模块系统

[TOC]

封装是面向对象编程的一个重要特性。类的声明由公有接口和私有实现构成，类可以通过只修改实现而不影响其用户的方式而得以演化。模块系统为编程带来了大致相同的益处。模块使类和包可以有选择性地获取，从而使得模块的演化可以受控。

多个现有的 Java 模块系统都依赖于类加载器来实现类之间的隔离。但是，Java 9 引入了一个由 Java 编译器和虚拟机支持的新系统，称为 Java 平台模块系统。



## 9.1 模块的概念

在面向对象编程中，基础的构建要素就是类。类提供了封裝，私有特性只能被具有明确访问权限的代码访问，即，只能被其所属类中的方法访问，这使得对访问权限的推断成为可能。如果某个私有变量发生了变化，那么我们就会发现一系列可能出错的方法。如果需要修改私有表示，那么就需要知道哪些方法会受到影响。

在 Java 中，包提供了更高一级的组织方式，包是类的集合。包也提供了一种封装级别，具有包访问权限的所有特性（无论是公有的还是私有的）都只能被同一个包中的方法访问。

但是，在大型系统中，这种级别的访问控制仍显不足。所有公有特性（即在包的外部也可以访问的特性）可以从任何地方访问。假设我们想要修改或剔除一个很少使用的特性，如果它是公有的，那么就没有办法推断这个变化所产生的影响。

Java 平台的设计者们在面对规模超大且盘根错节的代码时，认为他们需要一种能够提供更多控制能力的构建机制。于是，他们设计了一个新的系统，称为 Java 平台模块系统，现在成了 Java 语言和虚拟机的一部分。

一个 Java 平台模块包含：

+ 一个包集合。
+ 可选地包含资源文件和像本地库这样的其他文件。
+ 一个有关模块中可访问的包的列表。
+ 一个有关这个模块依赖的所有其他模块的列表。

为什么在我们自己的程序中要考虑使用 Java 平台模块系统而不是传统的使用 JAR 文件呢？因为这样做有以下两个优点。
1. 强封装：我们可以控制哪些包是可访问的，并且无须操心去维护那些我们不想开放给公众去访问的代码。
2. 可靠的配置：我们可以避免诸如类重复或丢失这类常见的类路径问题。



## 9.2 对模块命名

模块是包的集合。模块中的包名无须彼此相关。例如，java.sql 模块中就包含了 java.sql、javax.sql 和 javax.transaction.xa 这几个包。并且，正如这个例子所示，模块名和包名相同是完全可行的。

模块名是由字母、数字、下划线和句点构成的。而且，模块之间没有任何层次关系。如果有一个模块是 com.horstmann，另一个模块是 com.horstmann.corejava，那么就模块系统而言，它们是无关的。

当创建供他人使用的模块时，重要的是要确保它的名字是全局唯一的。我们期望大多数的模块名都遵循“反向域名”惯例，就像包名一样。

命名模块最简单的方式就是按照模块提供的顶级包来命名。这个惯例可以防止模块中产生包名冲突，这是因为每个包都只能放在一个模块中。

我们还可以使用更短的模块名来命名不打算给其他程序员使用的模块，下一节的例子中就使用了这种方式。

>注意：模块名只用于模块声明中。在 Java 类的源文件中，永远都不应该引用模块名，而是应该按照一如既往的方式去使用包名。



## 9.3 模块化的“Hello World”

让我们把传统的“Hello, world ”程序转换为一个模块。首先，我们需要将这个类放到一个包中，“不具名的”包是不能包含在模块中的。下面是代码：
```java
package com.horstmann.hello;

public class HelloWorld
{
    public static void main(String[] args)
    {
        System.out.println("Hello, Modular World!");
    }
}
```

到目前为止，还没有任何东西有变化。为了创建包含这个包的 v2chog.hellomod模块，需要添加一个模块声明，可以将其置于名为 module.info. java 的文件中，该文件位于基目录中。基目录就是包含com的目录。按照惯例，基目录的名字与模块名相同。

module-info. java 文件包含模块声明：
```java
module v2chog.hellomod
{
}
```

这个模块声明之所以为空，是因为该模块没有任何可以向其他人提供的内容，它也不需要依赖任何东西。

现在，按照往常一样编译它：

```shell
javac v2chog.hellomod/module-info.java v2cheg.hellomod/com/horstmann/hello/HelloWorld.java
```

module. info.java 这个文件看起来与 Java 资源文件不同，当然，也不可能存在名为 module-info 的类，因为类名不能包合连字符。关键词 module 和在下一节将会看到的 requires、 exports 等关键词都是“限定关键词”，即只在模块声明中具有特殊含义。这个文件会以二进制形式
编译到包含该模块定义的类文件 module-info.class 中。

为了让这个程序作为模块化应用程序来运行，需要指定模块路径，它与类路径相似，但是包含的是模块。还需要以 模块名/类名 的形式指定主类：

```shell
java --module-path v2ch09.hellomod --module v2cheg.hellomod/com.horstmann.hello.HelLoworld
```

也可以不使用 --module-path 和 -module，而是使用单字母选项-p 和-m：
```shell
java - p v2che9.hellomod -m v2chog.hellomod/com.horstmann.hello.HelloWorld
```


无论哪种方式，都会显示问候语“"Hello, Module World!”，证明我们成功地模块化了第一个应用程序。













