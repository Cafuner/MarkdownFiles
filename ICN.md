# ICN 项目面试问题



## 基于信息中心网络架构的音视频直播系统

这个项目是基于一种叫做Information Centric Network的网络，简称ICN。它是不同与传统的TCP/IP网络的一种面向未来的网络架构。在学术界它被认为是最有可能取代TCP/IP的网络架构。它与TCP/IP最核心的不同点就是对资源命名，而不是对主机命名。这种网络的的传输方式是依靠两种类型的包，一个叫Interest，一个叫Data。主机向网络发送Interest包来请求资源，每个Interest携带一个可路由的资源名称，网络最终返回给主机一个Data包。这种架构具有网内缓存、天然支持广播、高安全性等特点。我的研究就是在这样的网络上设计和实现视频直播系统。

具体的实现分为音视频采集、传输和播放。

1. 音视频采集我是利用开源的ffmpeg的api来进行采集的，用开源的x264编码器对视频进行编码。
2. 音视频的传输的基本原理是把视频按照MTU进行分包，每个包都有序列号，客户端不断发送Interest请求视频包，服务器一边产生包一边响应Interest。在传输层我用的是经过修改适配ICN网路的RTP协议。RTP协议的视频和音频是分开传输的，所以我用两个socket分别传输两种数据，在客户端一个线程采用epoll来多路复用同时监听这两个socket的读事件。服务端整体上是一个生产者消费者模型。我用了两个线程和一个环形队列缓冲区。一个线程按照固定的速率去生成视频数据，放到缓冲区，另一个线程监听socket，从缓冲区拿数据响应客户发来的Interest。这两个线程相当于一个生产者一个消费者，所以他们用的生产者消费者的并发控制模型。有一点区别在于，我这里没有队列不满的条件变量，因为我的生产者会不断生产数据，如果满了就把旧数据覆盖。
3. 播放我用的是一个开源的视频播放器，VLC，它的代码是高度模块化的，我把其中的输入部分换成了我从ICN网络收到的数据包，从而实现了播放。



## ICN网络相比于TCP/IP网络有什么优势？

1. 最核心的是网内缓存。ICN网络的每个路由器都有数据缓存，如果它收到的Interest命中了缓存，那么就不用转发这个请求了，直接用缓存来响应请求即可。
2. 天然支持广播，极大的提高了广播的效率。在网络中每个路由器都是有状态的，如果它的多个网络接口收到了对同一个资源的请求，那么它就可以合并这些请求，只向服务器发出一份请求，等响应到达的时候给每个端口都发一份即可。这样就极大的减轻了上游的带宽负担。
3. 去中性化。ICN网络是直接对数据命名，所以不需要域名解析服务。另外，由于网内所有节点都可以缓存和发布数据，所以减少了对中心化服务器的依赖。
4. 安全性。由于ICN网络允许每个节点缓存数据，所以它必须要对数据的真实性做保障。也就说它的Data是服务器做过数字签名的，只要客户端能用服务器的公钥解码出正确的报文摘要，那么数据就是真实可信的。



## ICN网络有什么劣势吗？

1. 过渡成本。TCP/IP网络架构在工业界已经非常成熟了，如果要过渡到新的网络架构成本非常高。对此问题也有一些兼容现有架构的研究工作，比如类似IPv6的隧道模式等等。
2. 在小规模网络中，ICN的复杂机制可能会得不偿失。这是因为ICN中的路由器是有状态的，他需要维护历史转发的Interest包和缓存。因此在小规模网络中可能没有TCP/IP直接转发的性能更高。





## 应用层如何管理ICN网络

Interest包和Data包的包头都有一些字段，应用层在发包时可以配置这些字段。

例如，在Interest包头中如下字段：

1. InterestLifeTime：设置Interest在网络中存留的最大时间。
2. HopLimit：设置Interest在网络中被转发的最多次数。
3. CanBePrefix：Interest携带的资源名称是否可以被含有该前缀的Data响应。

在Data包中：

1. Timestamp：Data产生的时间戳。
2. Signature：数字签名信息。
3. Metainfo：Data包长度、生命周期等。





## ICN的组播比UDP组播有什么优势

1. ICN的组播是天然形成的，对应用层透明，没有多余的开销，只要多个客户端请求的是相同的数据就可以形成组播，所以严格来将主机请求的所有资源都经过了组播。而UDP的组播需要应用层参与，利用IGMP协议注册到指定的组播组，组播实现机制复杂且有额外的开销，而且只有自己什么加入的组播组里的资源才是组播，其他资源仍然是单播。
2. ICN的组播支持的范围更广。在ICN网络中的每个路由器都可以通过合并Interest和分发Data来实现组播，因此极端情况下对于某一种资源可能全网只有一个根节点，形成一个巨大的广播树。所以本质上ICN对组播的数量和组播成员的数量都没有限制。而UDP中要实现组播那么源主机和目的主机之间的所有路由器都必须支持IGMP协议。但目前在广域网级别上的路由器默认都禁止传播组播组，所以很难实现大范围的UDP组播。















